<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ—Ä–º–∞ –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-miner {
            background: linear-gradient(135deg, #1f2937 0%, #0d0e12 100%);
        }
        .crystal-bounce:active {
            transform: scale(1.05);
            transition: transform 0.1s ease-out;
        }
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #3b82f6;
            border-radius: 10px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #1f2937;
        }
    </style>
    <script>
        
        // --- –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (–ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) ---
        const INITIAL_STATE = {
            crystals: 0,
            clickPower: 1, 
            drillCount: 0, 
            cps: 0,        
            upgrades: {}   
        };

        window.gameState = { ...INITIAL_STATE };

        window.gameData = {
            drillCost: 10,
            drillCps: 1,
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (maxLevel) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            clickUpgrades: [
                { id: 'click1', name: '–ú–∞–≥–Ω–∏—Ç–Ω—ã–π –ê–¥–∞–ø—Ç–µ—Ä', cost: 50, multiplier: 2, maxLevel: 5 },
                { id: 'click2', name: '–õ–∞–∑–µ—Ä–Ω–∞—è –ì—Ä–∞–≤–∏—Ä–æ–≤–∫–∞', cost: 500, multiplier: 3, maxLevel: 3 }
            ],
            cpsUpgrades: [
                { id: 'cps1', name: '–°–∏—Å—Ç–µ–º–∞ –û—Ö–ª–∞–∂–¥–µ–Ω–∏—è', cost: 100, multiplier: 1.5, maxLevel: 5 },
                { id: 'cps2', name: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ß–∏–ø', cost: 1000, multiplier: 2, maxLevel: 3 }
            ]
        };
        
        const LOCAL_STORAGE_KEY = 'crystal_miner_save';
        
        // --- –§–£–ù–ö–¶–ò–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø/–ó–ê–ì–†–£–ó–ö–ò ---

        function loadGameState() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) {
                try {
                    const loadedState = JSON.parse(savedData);
                    window.gameState = { ...INITIAL_STATE, ...loadedState };
                    console.log("–°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ LocalStorage.");
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞–Ω–Ω—ã—Ö LocalStorage:", e);
                    window.gameState = { ...INITIAL_STATE };
                }
            } else {
                 console.log("–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É.");
            }

            recalculateStats();
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            updateUI();
        }

        window.saveGameState = function() {
            try {
                const dataToSave = {
                    crystals: window.gameState.crystals,
                    clickPower: window.gameState.clickPower,
                    drillCount: window.gameState.drillCount,
                    cps: window.gameState.cps,
                    upgrades: window.gameState.upgrades
                };
                
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave));
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –≤ LocalStorage:", error);
            }
        }
        
        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
        
        function recalculateStats() {
            // –ü–µ—Ä–µ—Å—á–µ—Ç Click Power
            let baseClickPower = 1;
            window.gameData.clickUpgrades.forEach(upgrade => {
                const level = window.gameState.upgrades[upgrade.id] || 0;
                baseClickPower += (upgrade.multiplier - 1) * level;
            });
            window.gameState.clickPower = Math.round(baseClickPower * 10) / 10; 

            // –ü–µ—Ä–µ—Å—á–µ—Ç CPS (Crystals Per Second)
            let baseCps = window.gameState.drillCount * window.gameData.drillCps;
            let cpsMultiplier = 1; 
            
            window.gameData.cpsUpgrades.forEach(upgrade => {
                const level = window.gameState.upgrades[upgrade.id] || 0;
                cpsMultiplier *= Math.pow(upgrade.multiplier, level);
            });
            
            window.gameState.cps = Math.round(baseCps * cpsMultiplier * 10) / 10; 
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            const crystals = Math.floor(window.gameState.crystals);
            document.getElementById('crystals-display').textContent = crystals.toLocaleString('ru-RU');
            document.getElementById('cps-display').textContent = window.gameState.cps.toFixed(1);
            document.getElementById('click-power-display').textContent = window.gameState.clickPower;
            document.getElementById('drill-count-display').textContent = window.gameState.drillCount;
            document.getElementById('drill-count-display-2').textContent = window.gameState.drillCount;
            
            const drillCost = Math.floor(window.gameData.drillCost * Math.pow(1.15, window.gameState.drillCount));
            document.getElementById('drill-cost').textContent = drillCost.toLocaleString('ru-RU');
            document.getElementById('buy-drill-btn').disabled = crystals < drillCost;
            
            updateUpgradesSection('click-upgrades-list', window.gameData.clickUpgrades);
            updateUpgradesSection('cps-upgrades-list', window.gameData.cpsUpgrades);
        }
        
        // –ò–ó–ú–ï–ù–ï–ù–ê: –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ú–∞–∫—Å. –£—Ä–æ–≤–µ–Ω—å"
        function updateUpgradesSection(containerId, upgrades) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            
            upgrades.forEach(upgrade => {
                const currentLevel = window.gameState.upgrades[upgrade.id] || 0;
                const isMaxLevel = currentLevel >= upgrade.maxLevel; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                
                // –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ (base_cost * 2^level)
                const nextCost = Math.floor(upgrade.cost * Math.pow(2, currentLevel));
                
                // –ö–Ω–æ–ø–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –µ—Å–ª–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –º–µ–Ω—å—à–µ –∏–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å
                const isDisabled = window.gameState.crystals < nextCost || isMaxLevel; 
                const progress = (currentLevel / upgrade.maxLevel) * 100;

                // --- –õ–û–ì–ò–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–ù–û–ü–ö–ò ---
                let buttonText;
                let buttonClass;

                if (isMaxLevel) {
                    buttonText = '–ú–ê–ö–°. –£–†–û–í–ï–ù–¨';
                    buttonClass = 'bg-blue-900 text-blue-300 cursor-not-allowed'; // –ù–æ–≤—ã–π —Å—Ç–∏–ª—å –¥–ª—è –º–∞–∫—Å. —É—Ä–æ–≤–Ω—è
                } else {
                    buttonText = `–£–ª—É—á—à–∏—Ç—å (${nextCost.toLocaleString('ru-RU')} Cr)`;
                    buttonClass = isDisabled 
                        ? 'bg-gray-500 text-gray-300 cursor-not-allowed' 
                        : 'bg-green-600 hover:bg-green-700 text-white';
                }
                // --- –ö–û–ù–ï–¶ –õ–û–ì–ò–ö–ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–ù–û–ü–ö–ò ---

                const element = `
                    <div class="p-3 bg-gray-700 rounded-lg shadow-md mb-2 flex flex-col sm:flex-row justify-between items-center transition duration-300 hover:bg-gray-600">
                        <div class="text-left w-full sm:w-2/3">
                            <p class="text-white font-bold">${upgrade.name}</p>
                            <p class="text-sm text-gray-400">–£—Ä. ${currentLevel} / ${upgrade.maxLevel} (x${upgrade.multiplier} —ç—Ñ—Ñ–µ–∫—Ç)</p>
                            <div class="h-1 mt-1 bg-gray-500 rounded">
                                <div style="width: ${progress}%;" class="h-full ${isMaxLevel ? 'bg-blue-300' : 'bg-blue-500'} rounded"></div>
                            </div>
                        </div>
                        <button id="upgrade-${upgrade.id}" 
                                class="mt-2 sm:mt-0 px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 ${buttonClass}"
                                onclick="buyUpgrade('${upgrade.id}')"
                                ${isDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
                container.innerHTML += element;
            });
        }

        window.manualClick = function() {
            const amount = window.gameState.clickPower;
            window.gameState.crystals += amount;
            updateUI();
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            const crystalEl = document.getElementById('crystal-button');
            const popup = document.createElement('div');
            popup.textContent = `+${amount}`;
            popup.className = 'absolute text-yellow-300 font-extrabold text-2xl pointer-events-none transition-all duration-500 ease-out opacity-0';
            popup.style.left = `${Math.random() * 80 + 10}%`;
            popup.style.top = `${Math.random() * 80 + 10}%`;
            crystalEl.appendChild(popup);
            
            setTimeout(() => {
                popup.style.transform = 'translateY(-50px)';
                popup.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                popup.remove();
            }, 500);
        }

        window.buyDrill = function() {
            const drillCost = Math.floor(window.gameData.drillCost * Math.pow(1.15, window.gameState.drillCount));
            if (window.gameState.crystals >= drillCost) {
                window.gameState.crystals -= drillCost;
                window.gameState.drillCount += 1;
                recalculateStats(); 
                updateUI();
                window.saveGameState(); 
            }
        }
        
        // –ò–ó–ú–ï–ù–ï–ù–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        window.buyUpgrade = function(upgradeId) {
            let upgrade;
            
            upgrade = window.gameData.clickUpgrades.find(u => u.id === upgradeId);
            if (!upgrade) {
                upgrade = window.gameData.cpsUpgrades.find(u => u.id === upgradeId);
            }

            if (!upgrade) return;

            const currentLevel = window.gameState.upgrades[upgradeId] || 0;
            
            // --- –ü–†–û–í–ï–†–ö–ê –ù–ê –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨ ---
            if (currentLevel >= upgrade.maxLevel) return;
            // --- –ö–û–ù–ï–¶ –ü–†–û–í–ï–†–ö–ò ---

            const cost = Math.floor(upgrade.cost * Math.pow(2, currentLevel));
            
            if (window.gameState.crystals >= cost) {
                window.gameState.crystals -= cost;
                window.gameState.upgrades[upgradeId] = currentLevel + 1;
                
                recalculateStats(); 
                updateUI();
                window.saveGameState(); 
            }
        }
        
        // --- –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ –ò–ì–†–´ ---
        function gameLoop() {
            if (window.gameState.cps > 0) {
                window.gameState.crystals += window.gameState.cps / 5; 
            }
            
            if (Date.now() % 5000 < 200) { 
                window.saveGameState();
            }

            updateUI();
        }

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ü–∏–∫–ª–∞ –∏–≥—Ä—ã
        window.onload = function() {
            loadGameState();
            setInterval(gameLoop, 200); 
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        window.addEventListener('beforeunload', () => {
             window.saveGameState();
        });

    </script>
</head>

<body class="bg-miner text-gray-100 min-h-screen">

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <header class="text-center mb-6">
            <h1 class="4xl font-extrabold text-blue-400">–§–µ—Ä–º–∞ –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ üíé</h1>
            <p class="text-sm text-gray-400 mt-1">–ö–ª–∏–∫–µ—Ä-—Ñ–∞—Ä–º–∏–ª–∫–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º</p>
            <p id="user-id" class="text-xs text-gray-500 mt-1">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (LocalStorage)</p>
        </header>

        <div id="loading-state" class="text-center p-10 bg-gray-800 rounded-xl shadow-lg">
            <p class="text-lg text-blue-400 animate-pulse">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>

        <div id="game-container" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">

            <div class="lg:col-span-1 bg-gray-800 p-6 rounded-xl shadow-xl flex flex-col items-center">
                <h2 class="text-2xl font-bold mb-4 text-center text-yellow-300">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

                <div class="w-full text-center mb-6 p-4 bg-gray-700 rounded-lg">
                    <p class="text-xl text-gray-400">–ö—Ä–∏—Å—Ç–∞–ª–ª—ã (Cr):</p>
                    <p id="crystals-display" class="text-5xl font-black text-white mt-1">0</p>
                    <p class="text-sm text-green-400 mt-2">
                        +<span id="cps-display">0.0</span>/—Å–µ–∫ | –ö–ª–∏–∫: <span id="click-power-display">1</span>
                    </p>
                </div>

                <button id="crystal-button" 
                        onclick="manualClick()" 
                        class="relative w-48 h-48 bg-purple-700 rounded-full shadow-2xl flex items-center justify-center crystal-bounce transition duration-150 overflow-hidden border-4 border-purple-400">
                    <span class="text-8xl" aria-label="Crystal Emoji">üíé</span>
                </button>
                <p class="text-gray-400 mt-4">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª, —á—Ç–æ–±—ã –¥–æ–±—ã–≤–∞—Ç—å!</p>

                <div class="mt-6 w-full text-center p-3 bg-gray-700 rounded-lg">
                    <p class="text-lg text-gray-300">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—É—Ä—ã:</p>
                    <p id="drill-count-display" class="3xl font-bold text-blue-300">0</p>
                </div>
            </div>

            <div class="lg:col-span-2 bg-gray-800 p-6 rounded-xl shadow-xl custom-scroll overflow-y-auto max-h-[80vh]">
                <h2 class="text-2xl font-bold mb-4 text-center text-green-400">–ú–∞–≥–∞–∑–∏–Ω –£–ª—É—á—à–µ–Ω–∏–π</h2>

                <div class="mb-6 border-b border-gray-700 pb-4">
                    <h3 class="text-xl font-semibold text-blue-300 mb-3">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –î–æ–±—ã—á–∞</h3>
                    <div class="p-4 bg-gray-700 rounded-lg shadow-md flex justify-between items-center">
                        <div>
                            <p class="text-white font-bold">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë—É—Ä–∞ (–¥–∞–µ—Ç +1.0 CPS)</p>
                            <p class="text-sm text-gray-400">–ö–æ–ª-–≤–æ: <span id="drill-count-display-2">0</span></p>
                        </div>
                        <button id="buy-drill-btn" 
                                onclick="buyDrill()" 
                                class="px-4 py-2 text-sm font-semibold rounded-lg transition duration-150 bg-yellow-600 hover:bg-yellow-700 text-white disabled:bg-gray-500 disabled:text-gray-300 disabled:cursor-not-allowed">
                            –ö—É–ø–∏—Ç—å (<span id="drill-cost">10</span> Cr)
                        </button>
                    </div>
                </div>

                <div class="mb-6 border-b border-gray-700 pb-4">
                    <h3 class="text-xl font-semibold text-blue-300 mb-3">–£–ª—É—á—à–µ–Ω–∏—è –ö–ª–∏–∫–µ—Ä–∞ (x –ö–ª–∏–∫)</h3>
                    <div id="click-upgrades-list">
                        </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-blue-300 mb-3">–£–ª—É—á—à–µ–Ω–∏—è CPS (x –ê–≤—Ç–æ–¥–æ–±—ã—á–∞)</h3>
                    <div id="cps-upgrades-list">
                        </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
